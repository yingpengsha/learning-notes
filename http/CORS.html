<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CORS | 飞行随笔</title>
    <meta name="description" content="yingpengsha 的学习笔记">
    
    
    <link rel="preload" href="/learning-notes/assets/css/0.styles.46b61a67.css" as="style"><link rel="preload" href="/learning-notes/assets/js/app.2cc13775.js" as="script"><link rel="preload" href="/learning-notes/assets/js/5.aff373d7.js" as="script"><link rel="prefetch" href="/learning-notes/assets/js/10.69fcc7e1.js"><link rel="prefetch" href="/learning-notes/assets/js/11.bd59a6f5.js"><link rel="prefetch" href="/learning-notes/assets/js/12.edc4d4f1.js"><link rel="prefetch" href="/learning-notes/assets/js/13.294f7aaa.js"><link rel="prefetch" href="/learning-notes/assets/js/14.6c2f6496.js"><link rel="prefetch" href="/learning-notes/assets/js/15.ab623690.js"><link rel="prefetch" href="/learning-notes/assets/js/16.0f9fc7ee.js"><link rel="prefetch" href="/learning-notes/assets/js/17.53dbf67f.js"><link rel="prefetch" href="/learning-notes/assets/js/2.436be95e.js"><link rel="prefetch" href="/learning-notes/assets/js/3.2cb10772.js"><link rel="prefetch" href="/learning-notes/assets/js/4.a8f0640a.js"><link rel="prefetch" href="/learning-notes/assets/js/6.e6f09e44.js"><link rel="prefetch" href="/learning-notes/assets/js/7.8cbe0042.js"><link rel="prefetch" href="/learning-notes/assets/js/8.b0fb5279.js"><link rel="prefetch" href="/learning-notes/assets/js/9.d53e678f.js">
    <link rel="stylesheet" href="/learning-notes/assets/css/0.styles.46b61a67.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/learning-notes/" class="home-link router-link-active"><!----> <span class="site-name">飞行随笔</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/learning-notes/" class="nav-link">首页</a></div><div class="nav-item"><a href="/learning-notes/about/index.html" class="nav-link">关于我</a></div><div class="nav-item"><a href="https://github.com/yingpengsha" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/learning-notes/" class="nav-link">首页</a></div><div class="nav-item"><a href="/learning-notes/about/index.html" class="nav-link">关于我</a></div><div class="nav-item"><a href="https://github.com/yingpengsha" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading open"><span>HTTP 学习笔记</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/learning-notes/http/TCPIP.html" class="sidebar-link">TCP/IP 五层模型</a></li><li><a href="/learning-notes/http/HTTP-History.html" class="sidebar-link">HTTP 协议的发展历史</a></li><li><a href="/learning-notes/http/HTTP-Connect.html" class="sidebar-link">HTTP 三次握手和四次挥手</a></li><li><a href="/learning-notes/http/URI-URL-URN.html" class="sidebar-link">URI、URL、URN</a></li><li><a href="/learning-notes/http/HTTP-Message.html" class="sidebar-link">HTTP 报文</a></li><li><a href="/learning-notes/http/HTTP-Code.html" class="sidebar-link">HTTP 状态码</a></li><li><a href="/learning-notes/http/Cross-Domain.html" class="sidebar-link">同源策略</a></li><li><a href="/learning-notes/http/JSONP.html" class="sidebar-link">跨域解决方案：JSONP</a></li><li><a href="/learning-notes/http/CORS.html" class="active sidebar-link">跨域解决方案：CORS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learning-notes/http/CORS.html#简介" class="sidebar-link">简介</a></li><li class="sidebar-sub-header"><a href="/learning-notes/http/CORS.html#两种请求" class="sidebar-link">两种请求</a></li><li class="sidebar-sub-header"><a href="/learning-notes/http/CORS.html#简单请求" class="sidebar-link">简单请求</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learning-notes/http/CORS.html#请求报文" class="sidebar-link">请求报文</a></li><li class="sidebar-sub-header"><a href="/learning-notes/http/CORS.html#响应报文" class="sidebar-link">响应报文</a></li></ul></li><li class="sidebar-sub-header"><a href="/learning-notes/http/CORS.html#预检请求（非简单请求）" class="sidebar-link">预检请求（非简单请求）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learning-notes/http/CORS.html#预请求报文" class="sidebar-link">预请求报文</a></li><li class="sidebar-sub-header"><a href="/learning-notes/http/CORS.html#预响应报文" class="sidebar-link">预响应报文</a></li><li class="sidebar-sub-header"><a href="/learning-notes/http/CORS.html#正式请求报文" class="sidebar-link">正式请求报文</a></li><li class="sidebar-sub-header"><a href="/learning-notes/http/CORS.html#正式响应报文" class="sidebar-link">正式响应报文</a></li></ul></li></ul></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>JS 学习笔记</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="cors"><a href="#cors" aria-hidden="true" class="header-anchor">#</a> CORS</h1> <p><a name="CdrH7"></a></p> <h2 id="简介"><a href="#简介" aria-hidden="true" class="header-anchor">#</a> 简介</h2> <p>跨域资源共享(<a href="https://developer.mozilla.org/en-US/docs/Glossary/CORS" target="_blank" rel="noopener noreferrer">CORS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>) 是一种机制，它使用额外的 <a href="https://developer.mozilla.org/en-US/docs/Glossary/HTTP" target="_blank" rel="noopener noreferrer">HTTP<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 头来告诉浏览器  让运行在一个 origin (domain) 上的Web应用被准许访问来自不同源服务器上的指定的资源。当一个资源从与该资源本身所在的服务器<strong>不同的域、协议或端口</strong>请求一个资源时，资源会发起一个<strong>跨域 HTTP 请求</strong>。</p> <p>CORS需要浏览器和服务器同时支持。目前，所有浏览器都支持该功能，IE 浏览器不能低于 IE 10。</p> <p>整个 CORS 通信过程，都是浏览器自动完成，不需要用户参与。对于开发者来说，CORS 通信与同源的 AJAX 通信没有差别，代码完全一样。浏览器一旦发现 AJAX 请求跨源，就会自动添加一些附加的头信息，有时还会多出一次附加的请求，但用户不会有感觉。</p> <p>因此，实现 CORS 通信的关键是服务器。只要服务器实现了 CORS 接口，就可以跨源通信。</p> <p><a name="yQVGU"></a></p> <h2 id="两种请求"><a href="#两种请求" aria-hidden="true" class="header-anchor">#</a> 两种请求</h2> <p>浏览器将CORS请求分成两类：简单请求（simple request）和预检请求（preflighted requests）。</p> <p>满足一下条件则为 <strong>简单请求</strong>，反之有一条条件不满足则为 <strong>预检请求</strong>。</p> <ul><li>使用下列方法之一：
<ul><li>GET</li> <li>HEAD</li> <li>POST</li></ul></li> <li>Fetch 规范定义了对 CORS 安全的首部字段集合，不得人为设置该集合之外的其他首部字段。该集合为：
<ul><li>Accept</li> <li>Accept-Language</li> <li>Content-Language</li> <li>Content-Type （Content-Type 的值仅限于下列三者之一）
<ul><li>text/plain</li> <li>multipart/form-data</li> <li>application/x-www-form-urlencoded</li></ul></li></ul></li> <li>请求中的任意 <code>XMLHttpRequestUpload</code> 对象均没有注册任何事件监听器； <code>XMLHttpRequestUpload</code> 对象可以使用 <code>XMLHttpRequest.upload</code> 属性访问。</li> <li>请求中没有使用 <code>ReadableStream</code> 对象。</li></ul> <blockquote><p><strong>注意</strong>: 这些跨域请求与浏览器发出的其他跨域请求并无二致。如果服务器未返回正确的响应首部，则请求方不会收到任何数据。因此，那些不允许跨域请求的网站无需为这一新的 HTTP 访问控制特性担心。</p></blockquote> <p><a name="KeZXX"></a></p> <h2 id="简单请求"><a href="#简单请求" aria-hidden="true" class="header-anchor">#</a> 简单请求</h2> <p>比如说，假如站点 http://foo.example 的网页应用想要访问 http://bar.other 的资源。http://foo.example 的网页中可能包含类似于下面的 JavaScript 代码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> invocation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">'http://bar.other/resources/public-data/'</span><span class="token punctuation">;</span>
   
<span class="token keyword">function</span> <span class="token function">callOtherDomain</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>invocation<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
    invocation<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    invocation<span class="token punctuation">.</span>onreadystatechange <span class="token operator">=</span> handler<span class="token punctuation">;</span>
    invocation<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>客户端和服务器之间使用 CORS 首部字段来处理跨域权限：</p> <p><img src="https://cdn.nlark.com/yuque/0/2019/png/268093/1557405773140-9443e870-adde-4948-93da-8eef7786f63a.png#align=left&display=inline&height=224&originHeight=224&originWidth=521&size=0&status=done&width=521" alt></p> <p><a name="JSvv4"></a></p> <h3 id="请求报文"><a href="#请求报文" aria-hidden="true" class="header-anchor">#</a> 请求报文</h3> <div class="language-http extra-class"><pre class="language-http"><code><span class="token request-line"><span class="token property">GET</span> /resources/public-data/ HTTP/1.1</span>
<span class="token header-name keyword">Host:</span> bar.other
<span class="token header-name keyword">User-Agent:</span> Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.1b3pre) Gecko/20081130 Minefield/3.1b3pre
<span class="token header-name keyword">Accept:</span> text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
<span class="token header-name keyword">Accept-Language:</span> en-us,en;q=0.5
<span class="token header-name keyword">Accept-Encoding:</span> gzip,deflate
<span class="token header-name keyword">Accept-Charset:</span> ISO-8859-1,utf-8;q=0.7,*;q=0.7
<span class="token header-name keyword">Connection:</span> keep-alive
<span class="token header-name keyword">Referer:</span> http://foo.example/examples/access-control/simpleXSInvocation.html
<span class="token header-name keyword">Origin:</span> http://foo.example
</code></pre></div><p>第 1~10 行是请求首部。第10行 的请求首部字段 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Origin" target="_blank" rel="noopener noreferrer"><code>Origin</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 表明该请求来源于 <code>http://foo.exmaple</code>。</p> <p><a name="K7bWw"></a></p> <h3 id="响应报文"><a href="#响应报文" aria-hidden="true" class="header-anchor">#</a> 响应报文</h3> <div class="language-http extra-class"><pre class="language-http"><code><span class="token response-status">HTTP/1.1 <span class="token property">200 OK</span></span>
<span class="token header-name keyword">Date:</span> Mon, 01 Dec 2008 00:23:53 GMT
<span class="token header-name keyword">Server:</span> Apache/2.0.61 
<span class="token header-name keyword">Access-Control-Allow-Origin:</span> *
<span class="token header-name keyword">Keep-Alive:</span> timeout=2, max=100
<span class="token header-name keyword">Connection:</span> Keep-Alive
<span class="token header-name keyword">Transfer-Encoding:</span> chunked
<span class="token header-name keyword">Content-Type:</span> application/xml<span class="token application/xml">

[XML Data]
</span></code></pre></div><p>第 1~10 行是来自于 http://bar.other 的服务端响应。<br>响应中携带了响应首部字段 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Allow-Origin" target="_blank" rel="noopener noreferrer"><code>Access-Control-Allow-Origin</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（第 4 行）。<br>使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Origin" target="_blank" rel="noopener noreferrer"><code>Origin</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 和 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Allow-Origin" target="_blank" rel="noopener noreferrer"><code>Access-Control-Allow-Origin</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 就能完成最简单的访问控制。<br>本例中，服务端返回的 <code>Access-Control-Allow-Origin: *</code> 表明，该资源可以被<strong>任意</strong>外域访问。如果服务端仅允许来自 http://foo.example 的访问，该首部字段的内容如下：<br><code>Access-Control-Allow-Origin: http://foo.example</code></p> <p>现在，除了 http://foo.example，其它外域均不能访问该资源（该策略由请求首部中的 ORIGIN 字段定义，见第10行）。<code>Access-Control-Allow-Origin</code> 应当为 * 或者包含由 Origin 首部字段所指明的域名。</p> <p><a name="LN3Nn"></a></p> <h2 id="预检请求（非简单请求）"><a href="#预检请求（非简单请求）" aria-hidden="true" class="header-anchor">#</a> 预检请求（非简单请求）</h2> <p>与前述简单请求不同，“需预检的请求”要求必须首先使用 <code>OPTIONS</code> 方法发起一个预检请求到服务器，以获知服务器是否允许该实际请求。“预检请求”的使用，可以避免跨域请求对服务器的用户数据产生未预期的影响。</p> <p>如下是一个需要执行预检请求的 HTTP 请求：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> invocation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">'http://bar.other/resources/post-here/'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> body <span class="token operator">=</span> <span class="token string">'&lt;?xml version=&quot;1.0&quot;?&gt;&lt;person&gt;&lt;name&gt;Arun&lt;/name&gt;&lt;/person&gt;'</span><span class="token punctuation">;</span>
    
<span class="token keyword">function</span> <span class="token function">callOtherDomain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>invocation<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      invocation<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'POST'</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      invocation<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">'X-PINGOTHER'</span><span class="token punctuation">,</span> <span class="token string">'pingpong'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      invocation<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'application/xml'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      invocation<span class="token punctuation">.</span>onreadystatechange <span class="token operator">=</span> handler<span class="token punctuation">;</span>
      invocation<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面的代码使用 POST 请求发送一个 XML 文档，该请求包含了一个自定义的请求首部字段（X-PINGOTHER: pingpong）。另外，该请求的 Content-Type 为 application/xml。因此，该请求需要首先发起“预检请求”。</p> <p><img src="https://cdn.nlark.com/yuque/0/2019/png/268093/1557406466002-fb6ac596-8f16-4413-b34d-b44673939de3.png#align=left&display=inline&height=553&originHeight=553&originWidth=521&size=0&status=done&width=521" alt></p> <p><a name="rAE3G"></a></p> <h3 id="预请求报文"><a href="#预请求报文" aria-hidden="true" class="header-anchor">#</a> 预请求报文</h3> <div class="language-http extra-class"><pre class="language-http"><code><span class="token request-line"><span class="token property">OPTIONS</span> /resources/post-here/ HTTP/1.1</span>
<span class="token header-name keyword">Host:</span> bar.other
<span class="token header-name keyword">User-Agent:</span> Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.1b3pre) Gecko/20081130 Minefield/3.1b3pre
<span class="token header-name keyword">Accept:</span> text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
<span class="token header-name keyword">Accept-Language:</span> en-us,en;q=0.5
<span class="token header-name keyword">Accept-Encoding:</span> gzip,deflate
<span class="token header-name keyword">Accept-Charset:</span> ISO-8859-1,utf-8;q=0.7,*;q=0.7
<span class="token header-name keyword">Connection:</span> keep-alive
<span class="token header-name keyword">Origin:</span> http://foo.example
<span class="token header-name keyword">Access-Control-Request-Method:</span> POST
<span class="token header-name keyword">Access-Control-Request-Headers:</span> X-PINGOTHER, Content-Type
</code></pre></div><p>浏览器检测到，从 JavaScript 中发起的请求需要被预检。从上面的报文中，我们看到，第 1~12 行发送了一个使用 <code>OPTIONS</code> 方法的“预检请求”。 <code>OPTIONS</code> 是 HTTP/1.1 协议中定义的方法，用以从服务器获取更多信息。该方法不会对服务器资源产生影响。 预检请求中同时携带了下面两个首部字段：</p> <div class="language-http extra-class"><pre class="language-http"><code><span class="token header-name keyword">Access-Control-Request-Method:</span> POST
<span class="token header-name keyword">Access-Control-Request-Headers:</span> X-PINGOTHER, Content-Type
</code></pre></div><p><a name="8A2rz"></a></p> <h3 id="预响应报文"><a href="#预响应报文" aria-hidden="true" class="header-anchor">#</a> 预响应报文</h3> <div class="language-http extra-class"><pre class="language-http"><code><span class="token response-status">HTTP/1.1 <span class="token property">200 OK</span></span>
<span class="token header-name keyword">Date:</span> Mon, 01 Dec 2008 01:15:39 GMT
<span class="token header-name keyword">Server:</span> Apache/2.0.61 (Unix)
<span class="token header-name keyword">Access-Control-Allow-Origin:</span> http://foo.example
<span class="token header-name keyword">Access-Control-Allow-Methods:</span> POST, GET, OPTIONS
<span class="token header-name keyword">Access-Control-Allow-Headers:</span> X-PINGOTHER, Content-Type
<span class="token header-name keyword">Access-Control-Max-Age:</span> 86400
<span class="token header-name keyword">Vary:</span> Accept-Encoding, Origin
<span class="token header-name keyword">Content-Encoding:</span> gzip
<span class="token header-name keyword">Content-Length:</span> 0
<span class="token header-name keyword">Keep-Alive:</span> timeout=2, max=100
<span class="token header-name keyword">Connection:</span> Keep-Alive
<span class="token header-name keyword">Content-Type:</span> text/plain
</code></pre></div><p><a name="0NT3R"></a></p> <h3 id="正式请求报文"><a href="#正式请求报文" aria-hidden="true" class="header-anchor">#</a> 正式请求报文</h3> <div class="language-http extra-class"><pre class="language-http"><code><span class="token request-line"><span class="token property">POST</span> /resources/post-here/ HTTP/1.1</span>
<span class="token header-name keyword">Host:</span> bar.other
<span class="token header-name keyword">User-Agent:</span> Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.1b3pre) Gecko/20081130 Minefield/3.1b3pre
<span class="token header-name keyword">Accept:</span> text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
<span class="token header-name keyword">Accept-Language:</span> en-us,en;q=0.5
<span class="token header-name keyword">Accept-Encoding:</span> gzip,deflate
<span class="token header-name keyword">Accept-Charset:</span> ISO-8859-1,utf-8;q=0.7,*;q=0.7
<span class="token header-name keyword">Connection:</span> keep-alive
<span class="token header-name keyword">X-PINGOTHER:</span> pingpong
<span class="token header-name keyword">Content-Type:</span> text/xml; charset=UTF-8
<span class="token header-name keyword">Referer:</span> http://foo.example/examples/preflightInvocation.html
<span class="token header-name keyword">Content-Length:</span> 55
<span class="token header-name keyword">Origin:</span> http://foo.example
<span class="token header-name keyword">Pragma:</span> no-cache
<span class="token header-name keyword">Cache-Control:</span> no-cache<span class="token text/xml">

<span class="token prolog">&lt;?xml version=&quot;1.0&quot;?&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>person</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>Arun<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>person</span><span class="token punctuation">&gt;</span></span>
</span></code></pre></div><p><a name="mmCY1"></a></p> <h3 id="正式响应报文"><a href="#正式响应报文" aria-hidden="true" class="header-anchor">#</a> 正式响应报文</h3></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/learning-notes/http/JSONP.html" class="prev">
          跨域解决方案：JSONP
        </a></span> <span class="next"><a href="/learning-notes/js/Array-API.html">
          数组常用方法
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/learning-notes/assets/js/app.2cc13775.js" defer></script><script src="/learning-notes/assets/js/5.aff373d7.js" defer></script>
  </body>
</html>
